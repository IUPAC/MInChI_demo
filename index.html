<!DOCTYPE html>
<html>

<head>
	<title>MInChI Demo</title>

	<link rel="icon" href="icon.ico" type="image/x-icon" />
	<link rel="shortcut icon" href="icon.ico" type="image/x-icon" />
	<link href="main.css" rel="stylesheet" type="text/css">
	<link href="widgets.css" rel="stylesheet" type="text/css">
	<script src="jquery.js" type="text/javascript"></script>
    <script src="mixfile.js" type="text/javascript"></script>
</head>

<body style="min-height: 100vh;">
	<h1 style="margin: 0.5em 0.5em 0 0.5em;">MInChI Demo</h1>

	<div style="padding: 1em;">
		<div id="root" style="display: inline-block; background-color: #F8F8F8;"></div>
		<div id="buttons" style="padding-top: 0.5em;"></div>
		<div id="minchi"></div>
	</div>

	<pre id="data" style="display: none;">
		{
			"contents": 
			[
				{
					"name": "Trimethylaluminum",
					"quantity": 2,
					"units": "mol/L",
					"molfile": "\nGenerated by WebMolKit\n\n  4  3  0  0  0  0  0  0  0  0999 V2000\n   -1.2990   -0.7500    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.0000    0.0000 Al  0  0  0  0  0  0  0  0  0  0  0  0\n    1.2990   -0.7500    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.5000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  2  4  1  0  0  0  0\nM  END"
				},
				{
					"name": "toluene",
					"molfile": "\nGenerated by WebMolKit\n\n  7  7  0  0  0  0  0  0  0  0999 V2000\n    2.5714    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.0714    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.3214   -1.2990    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.1786   -1.2990    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.9286    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.1786    1.2990    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.3214    1.2990    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  2  0  0  0  0\n  5  6  1  0  0  0  0\n  6  7  2  0  0  0  0\n  7  2  1  0  0  0  0\nM  END"
				}
			]
		}
	</pre>
</body>

<script type="module">
	import molfileToInChI from './inchi-run.js';
	Mixtures.InChI.nativeMolfileToInChI = molfileToInChI;

	wmk.initWebMolKit('res');
	var widget = new Mixtures.WebWidget();
	var mixture = new Mixtures.Mixture(JSON.parse($('#data').text()));
	widget.render($('#root'), 700, 600);
	widget.setMixture(mixture);

	let btnMInChI = $('<button class="wmk-button wmk-button-primary">Create MInChI</button>').appendTo($('#buttons'));
	btnMInChI.click(() => 
	{
		if (widget.isBlank())
		{
			alert('Mixture is empty.');
			return;
		}
		$('#minchi').empty();

		let mixture = widget.getMixture();
		let maker = new Mixtures.ExportMInChI(mixture.mixfile);
		maker.fillInChI().then(() =>
		{
			maker.formulate();
			let pre = $('<pre/>').appendTo($('#minchi')).css({'padding-top': '0.5em'});
			let minchi = maker.getResult(), segment = maker.getSegment();
			for (let n = 0; n < minchi.length; n++)
			{
				let span = $('<span/>').appendTo(pre);
				span.text(minchi.charAt(n));
				if (segment[n] == Mixtures.MInChISegment.Header) span.css('background-color', '#FFC0C0');
				else if (segment[n] == Mixtures.MInChISegment.Component) span.css('background-color', '#C0C0FF');
				else if (segment[n] == Mixtures.MInChISegment.Hierarchy) span.css('background-color', '#E0E080');
				else if (segment[n] == Mixtures.MInChISegment.Concentration) span.css('background-color', '#80E080');

			}
			
			/*pre.text(maker.getResult());
			pre.append('\n');
			pre.append(maker.getSegment().join(''));*/
		});
	});	
</script>

</html>